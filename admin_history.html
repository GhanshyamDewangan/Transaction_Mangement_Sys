<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Admin — History</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<style>
    /* Theme colors */
    :root {
      --bg:#f5f5f7;
      --card:#ffffff;
      --accent:#ff5b36;
      --muted:#7b7b85;
      --shadow:0 8px 20px rgba(0,0,0,0.05);
      --approved:#1ca84c;
      --rejected:#d9534f;
    }

    /* Global reset */
    *{
      margin:0;
      padding:0;
      box-sizing:border-box;
      font-family:'Inter',sans-serif;
    }

    /* Page layout */
    body{
      width:100%;
      height:100vh;
      overflow:hidden;
      background:#f3f3f6;
      display:flex;
    }

    /* Sidebar */
    .sidebar{
      width:260px;
      background:#fff4ee;
      padding:28px;
      height:100vh;
      display:flex;
      flex-direction:column;
      border-right:1px solid rgba(0,0,0,0.08);
    }

    /* Admin profile */
    .profile{
      display:flex;
      gap:12px;
      align-items:center;
      margin-bottom:20px;
    }

    /* Avatar */
    .avatar{
      width:60px;
      height:60px;
      border-radius:50%;
      background:#ffe2d6;
      color:#ff5b36;
      font-weight:700;
      font-size:22px;
      display:flex;
      align-items:center;
      justify-content:center;
      box-shadow:0 6px 18px rgba(255,91,44,0.18);
    }

    .name{font-size:18px;font-weight:700;}
    .role{font-size:13px;color:var(--muted);}

    /* Navigation */
    .nav{
      margin-top:24px;
      display:flex;
      flex-direction:column;
      gap:8px;
    }

    .nav button{
      padding:10px 14px;
      border:none;
      background:transparent;
      border-radius:12px;
      text-align:left;
      font-size:15px;
      font-weight:600;
      cursor:pointer;
      transition:.2s;
    }

    .nav button.active{
      background:#ffefe9;
      color:var(--accent);
    }

    .nav button:hover{
      background:#ffe8df;
      transform:translateX(4px);
    }

    /* Logout button */
    .logout-btn{
      margin-top:auto;
      padding:12px;
      background:white;
      border-radius:12px;
      border:1px solid #ffd1c1;
      font-weight:700;
      color:var(--accent);
      cursor:pointer;
    }

    /* Main content */
    .main{
      flex:1;
      padding:34px 40px;
      overflow-y:auto;
    }

    /* Page title */
    .top-title{
      font-size:26px;
      font-weight:700;
    }

    /* Summary cards */
    .cards{
      display:flex;
      gap:20px;
      margin-top:20px;
      margin-bottom:26px;
    }

    .card{
      flex:1;
      background:white;
      padding:20px;
      border-radius:14px;
      box-shadow:var(--shadow);
    }

    .card h4{font-size:13px;color:var(--muted);}
    .card .value{font-size:26px;font-weight:700;margin-top:6px;}

    /* Tabs */
    .tabs{
      display:flex;
      gap:14px;
      margin-bottom:20px;
    }

    .tab-btn{
      padding:10px 22px;
      background:white;
      border-radius:10px;
      font-weight:600;
      border:1px solid #ccc;
      cursor:pointer;
      transition:.2s;
    }

    .tab-btn.active{
      background:linear-gradient(90deg,#ff8a5a,#ff5b36);
      color:white;
      border:none;
    }

    /* Transaction item */
    .item{
      background:white;
      padding:22px 20px;
      border-radius:16px;
      margin-bottom:16px;
      box-shadow:var(--shadow);
      display:flex;
      justify-content:space-between;
      align-items:center;
    }

    .tid{
      color:var(--accent);
      font-weight:700;
      font-size:14px;
      margin-bottom:6px;
    }

    .tx-amount{font-size:18px;font-weight:700;color:#222;}
    .sub{font-size:13px;color:var(--muted);}

    .status-approved{
      color:var(--approved);
      font-weight:800;
      font-size:14px;
    }

    .status-rejected{
      color:var(--rejected);
      font-weight:800;
      font-size:14px;
    }
</style>
</head>

<body>

<!-- Sidebar -->
<div class="sidebar">

  <!-- Admin info -->
  <div class="profile">
    <div class="avatar" id="avatar">A</div>
    <div>
      <div class="name" id="profileName">Admin</div>
      <div class="role">Admin</div>
    </div>
  </div>

  <!-- Navigation -->
  <div class="nav">
    <button onclick="goHome()">Home</button>
    <button class="active">History</button>
    <button onclick="goAI()">AI Assistant</button>
  </div>

  <!-- Logout -->
  <button class="logout-btn" onclick="logout()">Log out</button>
</div>

<!-- Main content -->
<div class="main">

  <!-- Page heading -->
  <div class="top-title">Approval History</div>

  <!-- Summary cards -->
  <div class="cards">
    <div class="card">
      <h4>Total Approved</h4>
      <div class="value" id="approvedCount">0</div>
    </div>
    <div class="card">
      <h4>Total Rejected</h4>
      <div class="value" id="rejectedCount">0</div>
    </div>
  </div>

  <!-- Status tabs -->
  <div class="tabs">
    <button class="tab-btn active" id="tabA" onclick="switchTab('approved')">Approved</button>
    <button class="tab-btn" id="tabR" onclick="switchTab('rejected')">Rejected</button>
  </div>

  <!-- Approved list -->
  <div id="approvedList"></div>

  <!-- Rejected list -->
  <div id="rejectedList" style="display:none;"></div>

</div>

<script>
/* Check admin login */
const role = localStorage.getItem("td_role");
const admin = localStorage.getItem("td_username") || "Admin";

if(role !== "admin"){
  window.location.href = "index.html";
}

/* Show admin info */
profileName.innerText = admin;
avatar.innerText = admin.charAt(0).toUpperCase();

/* Store history data */
let approvedData = [];
let rejectedData = [];

/* Fetch admin history */
async function loadAdminHistory(){
  const res = await fetch("http://127.0.0.1:5000/admin/history");
  const data = await res.json();

  approvedData = data.filter(t => t.status === "Approved");
  rejectedData = data.filter(t => t.status === "Rejected");

  approvedCount.innerText = approvedData.length;
  rejectedCount.innerText = rejectedData.length;

  renderApproved();
}

/* Show approved transactions */
function renderApproved(){
  approvedList.innerHTML = "";

  approvedData.forEach(tx=>{
    approvedList.innerHTML += `
      <div class="item">
        <div>
          <div class="tid">${tx.transaction_id}</div>
          <div class="tx-amount">₹ ${tx.amount} — ${tx.requester}</div>
          <div class="sub">${tx.payee} • ${tx.transaction_date}</div>
        </div>
        <div class="status-approved">Approved</div>
      </div>`;
  });
}

/* Show rejected transactions */
function renderRejected(){
  rejectedList.innerHTML = "";

  rejectedData.forEach(tx=>{
    rejectedList.innerHTML += `
      <div class="item">
        <div>
          <div class="tid">${tx.transaction_id}</div>
          <div class="tx-amount">₹ ${tx.amount} — ${tx.requester}</div>
          <div class="sub">${tx.payee} • ${tx.transaction_date}</div>
        </div>
        <div class="status-rejected">Rejected</div>
      </div>`;
  });
}

/* Switch approved or rejected tab */
function switchTab(tab){
  if(tab === "approved"){
    approvedList.style.display = "block";
    rejectedList.style.display = "none";
    tabA.classList.add("active");
    tabR.classList.remove("active");
    renderApproved();
  }else{
    approvedList.style.display = "none";
    rejectedList.style.display = "block";
    tabR.classList.add("active");
    tabA.classList.remove("active");
    renderRejected();
  }
}

/* Go to admin home */
function goHome(){
  window.location.href = "admin_home.html";
}

/* Go to AI assistant */
function goAI(){
  window.location.href = "ai.html";
}

/* Logout admin */
function logout(){
  localStorage.clear();
  window.location.href = "index.html";
}

/* INITIAL LOAD */
loadAdminHistory();
</script>

</body>
</html>