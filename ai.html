<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>AI Assistant</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<style>
    /* Theme colors */
    :root{
        --accent:#ff5b36;
        --accent2:#ff8658;
        --muted:#7b7b85;
        --bg:#f3f3f6;
        --userBubble:#ffe7df;
        --botBubble:#ffffff;
        --shadow:0 8px 18px rgba(0,0,0,0.07);
    }

    /* Global reset */
    *{
        margin:0;
        padding:0;
        box-sizing:border-box;
        font-family:'Inter',sans-serif;
    }

    /* Page layout */
    body{
        display:flex;
        height:100vh;
        width:100%;
        background:var(--bg);
        overflow:hidden;
    }

    /* Sidebar container */
    .sidebar{
      width:260px;
      height:100vh;
      background:#fff4ee;
      padding:28px;
      display:flex;
      flex-direction:column;
      border-right:1px solid rgba(0,0,0,0.08);
    }

    /* User profile */
    .profile{
      display:flex;
      gap:12px;
      align-items:center;
    }

    /* Avatar */
    .avatar{
      width:60px;
      height:60px;
      border-radius:50%;
      background:#ffe2d6;
      color:#ff5b36;
      display:flex;
      justify-content:center;
      align-items:center;
      font-size:22px;
      font-weight:700;
      box-shadow:0 6px 18px rgba(255,91,44,0.2);
    }

    .name{font-size:18px;font-weight:700;color:#222;}
    .role{font-size:13px;color:var(--muted);}

    /* Sidebar navigation */
    .nav{
      margin-top:24px;
      display:flex;
      flex-direction:column;
      gap:8px;
    }

    .nav button{
      padding:10px 14px;
      border:none;
      background:transparent;
      text-align:left;
      font-weight:600;
      font-size:15px;
      border-radius:12px;
      cursor:pointer;
      transition:.2s;
    }

    /* Active menu */
    .nav button.active{
      background:#ffefe9;
      color:#ff5b36;
    }

    .nav button:hover{
      background:#ffe7df;
      transform:translateX(4px);
    }

    /* Logout button */
    .logout-btn{
      margin-top:auto;
      padding:12px;
      border-radius:12px;
      border:1px solid #ffd1c1;
      background:white;
      color:#ff5b36;
      font-weight:700;
      cursor:pointer;
    }

    /* Main chat area */
    .main{
        flex:1;
        display:flex;
        flex-direction:column;
        height:100vh;
        overflow:hidden;
    }

    /* Chat header */
    .chat-header{
        padding:20px 30px;
        background:white;
        box-shadow:var(--shadow);
        font-size:22px;
        font-weight:700;
        color:#222;
    }

    /* Chat messages container */
    .chat-window{
        flex:1;
        overflow-y:auto;
        padding:25px 40px;
        display:flex;
        flex-direction:column;
        gap:18px;
    }

    /* Bot message bubble */
    .bot-msg{
        max-width:60%;
        padding:14px 18px;
        background:var(--botBubble);
        border-radius:14px;
        box-shadow:var(--shadow);
        align-self:flex-start;
        border-left:4px solid var(--accent);
    }

    /* User message bubble */
    .user-msg{
        max-width:60%;
        padding:14px 18px;
        background:var(--userBubble);
        border-radius:14px;
        box-shadow:var(--shadow);
        align-self:flex-end;
        border-right:4px solid var(--accent);
    }

    /* Input wrapper */
    .input-wrapper{
        width:100%;
        display:flex;
        justify-content:center;
        padding:20px 0;
        background:white;
        box-shadow:0 -4px 12px rgba(0,0,0,0.05);
    }

    /* Input area */
    .input-area{
        width:55%;
        background:#fff;
        display:flex;
        align-items:center;
        gap:10px;
        padding:8px 14px;
        border-radius:40px;
        border:1px solid #ddd;
        box-shadow:0 3px 8px rgba(0,0,0,0.05);
        transition:.2s;
    }

    .input-area:focus-within{
        border-color:var(--accent);
        box-shadow:0 4px 14px rgba(255,91,44,0.2);
    }

    /* Message input */
    .input-area input{
        flex:1;
        border:none;
        outline:none;
        font-size:16px;
        background:transparent;
    }

    /* Send button */
    .send-btn{
        width:38px;
        height:38px;
        border-radius:50%;
        border:none;
        cursor:pointer;
        background:linear-gradient(90deg,#ff8658,#ff5b36);
        display:flex;
        justify-content:center;
        align-items:center;
        box-shadow:0 4px 12px rgba(255,91,44,0.3);
    }

    .send-btn img{
        width:22px;
        height:22px;
        filter:invert(1);
    }
</style>
</head>

<body>

<!-- Sidebar -->
<div class="sidebar">

    <!-- User info -->
    <div class="profile">
        <div class="avatar" id="avatar">U</div>
        <div>
            <div class="name" id="profileName">User</div>
            <div class="role" id="profileRole">role</div>
        </div>
    </div>

    <!-- Navigation -->
    <div class="nav">
        <button onclick="goHome()">Home</button>
        <button onclick="goHistory()">History</button>
        <button class="active">AI Assistant</button>
    </div>

    <!-- Logout -->
    <button class="logout-btn" onclick="logout()">Log out</button>
</div>

<!-- Chat panel -->
<div class="main">

    <!-- Chat title -->
    <div class="chat-header">AI Assistant</div>

    <!-- Chat messages -->
    <div class="chat-window" id="chatWindow">
        <div class="bot-msg">
            Hello! I am your AI Assistant.<br>
            How can I help you today?
        </div>
    </div>

    <!-- Input area -->
    <div class="input-wrapper">
        <div class="input-area">
            <input type="text" id="msgInput" placeholder="Ask anything..." onkeydown="checkEnter(event)">
            <button class="send-btn" onclick="sendMessage()">
                <img src="https://cdn-icons-png.flaticon.com/512/3682/3682321.png">
            </button>
        </div>
    </div>

</div>

<script>
/* Load user session */
const username = localStorage.getItem("td_username");
const role = localStorage.getItem("td_role");

/* Redirect if session not found */
if(!username || !role){
  window.location.href = "index.html";
}

/* Show user info in sidebar */
profileName.innerText = username;
profileRole.innerText = role;
avatar.innerText = username.charAt(0).toUpperCase();

/* Navigate to home based on role */
function goHome(){
  if(role === "admin"){
    window.location.href = "admin_home.html";
  }else{
    window.location.href = "home.html";
  }
}

/* Navigate to history based on role */
function goHistory(){
  if(role === "admin"){
    window.location.href = "admin_history.html";
  }else{
    window.location.href = "history.html";
  }
}

/* Logout user */
function logout(){
  localStorage.clear();
  window.location.href = "index.html";
}

/* Chat elements */
const chatWindow = document.getElementById("chatWindow");
const input = document.getElementById("msgInput");

/* Send user message to backend */
async function sendMessage(){
  const text = input.value.trim();
  if(text === "") return;

  addUserMessage(text);
  input.value = "";

  const thinking = document.createElement("div");
  thinking.className = "bot-msg";
  thinking.innerText = "Thinking...";
  chatWindow.appendChild(thinking);
  scrollToBottom();

  try{
    const res = await fetch("/chat",{
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body:JSON.stringify({ message:text })
    });

    const data = await res.json();
    thinking.innerText = data.reply;

  }catch(err){
    thinking.innerText = "Unable to connect to AI server.";
    console.error(err);
  }
}

/* Add user message to chat */
function addUserMessage(msg){
  const div = document.createElement("div");
  div.className = "user-msg";
  div.innerText = msg;
  chatWindow.appendChild(div);
  scrollToBottom();
}

/* Scroll chat to bottom */
function scrollToBottom(){
  chatWindow.scrollTop = chatWindow.scrollHeight;
}

/* Send message on Enter key */
function checkEnter(e){
  if(e.key === "Enter"){
    sendMessage();
  }
}
</script>

</body>
</html>